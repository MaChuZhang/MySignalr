
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Chat</title>
    <link href="~/Content/Css/font-awesome-4.7.0/css/font-awesome.css" rel="stylesheet" />
    <style type="text/css">
        ul {
         list-style:none
        }
        *{
        padding:0px;margin:0px;
        }
        html,body{
            height:100%;
        }
        #chat_main{
            height: 100%;
            width: 100%;
            position:relative;
            backface-visibility:hidden;
            background:url('../../Content/Images/body_bg.jpg') repeat;
            padding-top:50px;
        }
        .fr {
        float:right;
        }
        .clearfix {
        zoom:1;
        }
        .clearfix:before,.clearfix:after {
           display:table;line-height:0;content:"";
        }
        .clearfix:after {clear:both}
        .round_img{border-radius:50% 50% 50% 50%;height:100%;}
        .a_txt_link {color:#d2d2d2;font-size:11px;}
        .a_txt_link:hover{color:#f1f1f1}
       #chat_main .chat_container {width:1040px;margin:0px auto;background-color:#fbfbfb;height:600px;}
       #chat_main .chat_container #contract_panel {height:600px;width:260px;background-color:#292b2e;float:right;}
       #chat_main .chat_container #contract_panel .account_box{height:70px;padding:10px;    border-bottom: 1px #404247 solid;}
        #chat_main .chat_container #contract_panel .account_box dl {display:inline;height:100%}
        dt.account_img {height:100%;display:inline-block;float:left;margin-right:10px;}
        #chat_main .chat_container #contract_panel .account_box dl dd{height:50%;vertical-align:middle;line-height:35px;color:#fff}
        .search_box {height:30px;background-color:#33353A;line-height:30px;padding-left:20px;}
        a#btn_search {color: #d2d2d2;font-size: 14px;cursor: pointer;}
        a#btn_search:hover{
           font-size:15px;
           color:#f1f1f1;
        }
        input.input_contract {
          border:none;
          outline-style:none;
         background-color:#33353A;
        }
        div.contract_list_box ul.contract_list_ul {
        background-color:#33353A;
        }
        li.li_current {
        background-color:#292b2e;
        }

        div.contract_list_box ul.contract_list_ul li{
          border-top: 1px #404247 solid;
          cursor:pointer;
        }
            div.contract_list_box ul.contract_list_ul li div.headimg {
              height:50px;width:50px;margin:5px;display:inline-block;
            }
            
            div.contract_list_box ul.contract_list_ul li div.cont {
              display:inline-block;
              width:150px;
             margin-top:5px;
             margin-bottom:5px;
             margin-right:15px;
             height:50px;
             float:right;
            }
            div.contract_list_box ul.contract_list_ul li div.cont div.cont_box {
              height:50%;
               line-height:25px;
            }
                div.contract_list_box ul.contract_list_ul li div.cont  h6.name{
                color:#fff;
                display:inline;
            }
            div.contract_list_box ul.contract_list_ul li div.cont span.time{
                float: right;
            }
                .font_s_dark{
                 font-size:10px;
                 color:#d2d2d2;
                }
        .fl {
            float:left;
        }
        /*tab 切换*/
        div.tab_switch {
        /*margin-bottom:20px;*/
        margin-top:10px;
        margin-bottom:10px;
        }
        ul#tab_ul {
         border-bottom:1px #404247 solid;
        }
        li.selected_tab{
           font-weight:bold;
           color:#f1f1f1 !important;
        }
        ul#tab_ul li:hover {
           color:#f1f1f1;
        }
        ul#tab_ul li {
        float:left;
        font-size:10px;
        color:#d2d2d2;
        cursor:pointer;
        text-align:center;
        width:33.3%;
        position:relative;
        padding-bottom:14px;
        }
        .span_arrow{
          position:absolute;
        left:50%;
        bottom:-1px;
        margin-left:-10px;
        overflow:hidden;
        }
        .span_arrow i{
            border-color: transparent transparent #404247;
           border-width:10px;
          display: inline-block;
    width: 0;
    height: 0;
    border-style: solid;
    overflow: hidden;
    font-size: 0;
    line-height: 0;
    vertical-align: top;
        }
     .span_arrow em {
          margin: 4px 0px 0px -21px;
          border-color: transparent transparent #292b2e;
          border-width:8px;
        display: inline-block;
    width: 0px;
       height: 0px;
        font-size: 0px;
        line-height: 0;
         vertical-align: top;
          border-style: solid;
          overflow: hidden;
        }
        #tab_content {
        overflow:hidden;
        }
        #tab_content div.tab_fragment{
        
        }
        
        ul#qun_list{
            background-color: #33353A;
        }
        ul#qun_list  li{
        height:40px;
        line-height:40px;
        padding-left:15px;
          border-top: 1px #404247 solid;
        }
            ul#qun_list li > span {
        margin-right:10px;    
        }
        ul#qun_list .font_cw{
          color:#fff;
        }
    </style>
</head>
<body>
    <div id="chat_main">
        @*<div class="container">
            <input type="text" id="message" />
            <button type="button" id="sendMessage" value="Send">Send</button>
            <ul id="messageBox"></ul>
        </div>*@
        <div class="chat_container">
            <div id="contract_panel">
                <div class="account_box">
                    <dl>
                        <dt class="account_img"><img src="~/Content/Images/headimg.jpg" class="round_img" /></dt>
                        <dd><h4>12457878</h4></dd>
                        <dd><a href="javascript:void(0)" class="a_txt_link">更多信息</a></dd>
                    </dl>
                </div>
                <div class="tab_switch">
                    <ul id="tab_ul" class="clearfix">
                        <li onclick="selectTab(1,this)" class="selected_tab fl">
                           正在聊天
                            <span class="span_arrow">
                               <i></i>
                                <em></em>
                            </span>
                        </li>
                        <li onclick="selectTab(2,this)" class="fl"> 
                           联系人
                        </li>
                        <li onclick="selectTab(3,this)" class="fl">
                            群聊
                        </li>
                    </ul>
                  
                </div>
                <div id="tab_content">
                    <div id="tab1" class="tab_fragment">
                        <div class="contract_list_box">
                            <ul class="contract_list_ul">
                                <li>
                                    <div class="headimg">
                                        <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                    </div>
                                    <div class="cont">
                                        <div class="cont_top clearfix cont_box">
                                            <h6 class="name">科比布莱恩特</h6>
                                            <span class="time font_s_dark"><i class="fa fa-times"></i>14:58</span>
                                        </div>
                                        <div class="cont_bottom cont_box">
                                            <span class="font_s_dark">最新消息</span>
                                        </div>
                                    </div>
                                </li>
                                <li class="li_current">
                                    <div class="headimg">
                                        <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                    </div>
                                    <div class="cont">
                                        <div class="cont_top clearfix cont_box">
                                            <h6 class="name">科比布莱恩特</h6>
                                            <span class="time font_s_dark"><i class="fa fa-times"></i>14:58</span>
                                        </div>
                                        <div class="cont_bottom cont_box">
                                            <span class="font_s_dark">最新消息</span>
                                        </div>
                                    </div>
                                </li>
                                <li class="">
                                    <div class="headimg">
                                        <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                    </div>
                                    <div class="cont">
                                        <div class="cont_top clearfix cont_box">
                                            <h6 class="name">科比布莱恩特</h6>
                                            <span class="time font_s_dark"><i class="fa fa-times"></i>14:58</span>
                                        </div>
                                        <div class="cont_bottom cont_box">
                                            <span class="font_s_dark">最新消息</span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                      <div id="tab2" style="display:none" class="tab_fragment">
                          <div class="search_box">
                              <a id="btn_search"><span class="fa fa-search"></span></a>
                              <input type="text" placeholder="查找联系人" class="input_contract font_s_dark" />
                          </div>
                          <div class="contract_list_box">
                              <ul class="contract_list_ul">
                                  <li>
                                      <div class="headimg">
                                          <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                      </div>
                                      <div class="cont">
                                          <div class="cont_top clearfix cont_box">
                                              <h6 class="name">科比布莱恩特</h6>                                              
                                          </div>
                                          <div class="cont_bottom cont_box">
                                              <span class="font_s_dark">红米在线</span>
                                          </div>
                                      </div>
                                  </li>
                                  <li class="li_current">
                                      <div class="headimg">
                                          <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                      </div>
                                      <div class="cont">
                                          <div class="cont_top clearfix cont_box">
                                              <h6 class="name">科比布莱恩特</h6>
                                              <span class="time font_s_dark"><i class="fa fa-times"></i>14:58</span>
                                          </div>
                                          <div class="cont_bottom cont_box">
                                              <span class="font_s_dark">火狐在线</span>
                                          </div>
                                      </div>
                                  </li>
                                  <li class="">
                                      <div class="headimg">
                                          <img src="~/Content/Images/headimg.jpg" class="round_img" />
                                      </div>
                                      <div class="cont">
                                          <div class="cont_top clearfix cont_box">
                                              <h6 class="name">科比布莱恩特</h6>
                                              <span class="time font_s_dark"><i class="fa fa-times"></i>14:58</span>
                                          </div>
                                          <div class="cont_bottom cont_box">
                                              <span class="font_s_dark">最新消息</span>
                                          </div>
                                      </div>
                                  </li>
                              </ul>
                          </div>
                      </div>
                      <div id="tab3" style="display:none"  class="tab_fragment">
                          <div class="search_box">
                              <a id="btn_search"><span class="fa fa-search"></span></a>
                              <input type="text" placeholder="查找群聊" class="input_contract font_s_dark" />
                          </div>
                        <ul id="qun_list">
                             <li class="font_cw"><h6  class="fl">sese群</h6>
                               <span class="font_s_dark fr">20114545</span>
                              </li>
                            <li class="font_cw li_current"><h5 class="fl">sese群</h5>
                                <span class="font_s_dark fr">20114545</span>
                            </li>
                            <li class="font_cw"><h5 class="fl">xamarin群</h5>
                                <span class="font_s_dark fr">20114545</span>
                            </li>
                        </ul>
                      </div>
                </div>
            </div>
            <div id="chat_panel">

            </div>
        </div>
    </div>
    <script src="~/Scripts/jquery-2.0.3.js"></script>
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <script src="~/signalr/hubs"></script>  
    <script>
    function getExplorerInfo() {
        var explorer = window.navigator.userAgent.toLowerCase();
        //ie
        if (explorer.indexOf("msie") >= 0) {
            var ver = explorer.match(/msie ([\d.]+)/)[1];
            return { type: "IE", version: ver };
        }
        //firefox
        else if (explorer.indexOf("firefox") >= 0) {
            var ver = explorer.match(/firefox\/([\d.]+)/)[1];
            return { type: "Firefox", version: ver };
        }
        //Chrome
        else if (explorer.indexOf("chrome") >= 0) {
            var ver = explorer.match(/chrome\/([\d.]+)/)[1];
            return { type: "Chrome", version: ver };
        }
        //Opera
        else if (explorer.indexOf("opera") >= 0) {
            var ver = explorer.match(/opera.([\d.]+)/)[1];
            return { type: "Opera", version: ver };
        }
            //Safari
        else if (explorer.indexOf("Safari") >= 0) {
            var ver = explorer.match(/version\/([\d.]+)/)[1];
            return { type: "Safari", version: ver };
        }
    }
    function selectTab(index,obj)
    {
        var span_arrow = $("span.span_arrow");
        var span_arrowObj = span_arrow.prop("outerHTML");
        console.info(span_arrowObj);
        span_arrow.remove();
        $(obj).siblings().removeClass("selected_tab");
        switch (index)
        {
            case 1:
                $("#tab2,#tab3").hide();
                $("#tab1").show();
                $(obj).addClass("selected_tab").append(span_arrowObj);
                break;
            case 2:
                $("#tab1,#tab3").hide();
                $("#tab2").show();
                $(obj).addClass("selected_tab").append(span_arrowObj);
                break;
            case 3:
                $("#tab1,#tab2").hide();
                $("#tab3").show();
                $(obj).addClass("selected_tab").append(span_arrowObj);
                break;
        }
        
    }
    $(function () {
        //debugger
        //引用生成的集线器代理
        var chat = $.connection.serverHub;
        //注册服务器端已经定义的客户端方法sendMessage来显示消息
        chat.client.sendMessage = function (name,message)
        {
            //向页面添加消息
            $("#messageBox").append('<li><strong style="color:green">' + name + '</strong>-' + message + '</li>');
        }
        //开始连接服务器
        $.connection.hub.start().done(function (){
            $("#sendMessage").click(function (){
                //调用服务器中定义的方法
                chat.server.sendMsg(getExplorerInfo().type,$("#message").val());
                $("#message").val('').focus();
            });
        });
    })
    </script>
</body>
</html>

